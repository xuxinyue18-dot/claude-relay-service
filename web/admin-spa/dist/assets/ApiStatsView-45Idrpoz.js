import{aP as bt,r as D,c as j,aX as st,x as n,y as r,z as t,O as b,L as A,P as i,u as e,C as M,K as gt,aq as yt,aa as xt,f as ft,Y as kt,R as W,Q as tt,ac as et,J as lt,B as ot,o as pt,V as vt,I as nt,a5 as _t,q as ht,aW as wt,av as $t}from"./vue-vendor-R8HMg95E.js";import{_ as at,A as St,a as Ct}from"./index-CGcTkEyx.js";import{L as Tt}from"./LogoTitle-DyE_akhz.js";import{T as Kt}from"./ThemeToggle-DSVKnmin.js";import{_ as At}from"./Badge-DRvsZhbG.js";import{_ as Lt}from"./SectionHeader-f7aa9jnY.js";import{b as Pt}from"./vendor-Dr8jvgFu.js";import{_ as It}from"./WindowCountdown-DepWfpho.js";import Mt from"./TutorialView-DO-QYolD.js";import"./element-plus-BUfCkBQO.js";class Dt{constructor(){this.baseURL=window.location.origin,this.isDev=!1}async request(p,s={}){try{this.isDev&&p.startsWith("/admin")&&(p="/webapi"+p);const f=await fetch(`${this.baseURL}${p}`,{headers:{"Content-Type":"application/json",...s.headers},...s}),d=await f.json();if(!f.ok)throw new Error(d.message||`请求失败: ${f.status}`);return d}catch(f){throw console.error("API Stats request error:",f),f}}async getKeyId(p){return this.request("/apiStats/api/get-key-id",{method:"POST",body:JSON.stringify({apiKey:p})})}async getUserStats(p){return this.request("/apiStats/api/user-stats",{method:"POST",body:JSON.stringify({apiId:p})})}async getUserModelStats(p,s="daily"){return this.request("/apiStats/api/user-model-stats",{method:"POST",body:JSON.stringify({apiId:p,period:s})})}async getOemSettings(){try{return await this.request("/admin/oem-settings")}catch(p){return console.error("Failed to load OEM settings:",p),{success:!0,data:{siteName:"claude-relay-service",siteIcon:"",siteIconData:""}}}}async getBatchStats(p){return this.request("/apiStats/api/batch-stats",{method:"POST",body:JSON.stringify({apiIds:p})})}async getBatchModelStats(p,s="daily"){return this.request("/apiStats/api/batch-model-stats",{method:"POST",body:JSON.stringify({apiIds:p,period:s})})}}const Z=new Dt,rt=bt("apistats",()=>{const R=D(""),p=D(null),s=D(!1),f=D(!1),d=D(!0),g=D(""),m=D("daily"),x=D(null),h=D([]),L=D(null),y=D(null),K=D({siteName:"",siteIcon:"",siteIconData:""}),N=D(!1),w=D([]),_=D([]),c=D(null),l=D([]),I=D([]),E=j(()=>{const u={requests:0,inputTokens:0,outputTokens:0,cacheCreateTokens:0,cacheReadTokens:0,allTokens:0,cost:0,formattedCost:"$0.000000"};return N.value&&c.value?m.value==="daily"?c.value.dailyUsage||u:c.value.monthlyUsage||u:m.value==="daily"?L.value||u:y.value||u}),Q=j(()=>{if(!x.value||!E.value)return{tokenUsage:0,costUsage:0,requestUsage:0};const u=E.value,k=x.value.limits;return{tokenUsage:k.tokenLimit>0?Math.min(u.allTokens/k.tokenLimit*100,100):0,costUsage:k.dailyCostLimit>0?Math.min(u.cost/k.dailyCostLimit*100,100):0,requestUsage:k.rateLimitRequests>0?Math.min(u.requests/k.rateLimitRequests*100,100):0}});async function z(){if(N.value)return Y();const u=R.value.trim();if(!u){g.value="请输入 API Key";return}if(u.length<10||u.length>512){g.value="API Key 格式无效：长度应在 10-512 个字符之间";return}s.value=!0,g.value="",x.value=null,h.value=[],p.value=null;try{const k=await Z.getKeyId(u);if(k.success){p.value=k.data.id;const P=await Z.getUserStats(p.value);if(P.success)x.value=P.data,await B(),g.value="",J();else throw new Error(P.message||"查询失败")}else throw new Error(k.message||"获取 API Key ID 失败")}catch(k){console.error("Query stats error:",k),g.value=k.message||"查询统计数据失败，请检查您的 API Key 是否正确",x.value=null,h.value=[],p.value=null}finally{s.value=!1}}async function B(){p.value&&(await Promise.all([V("daily"),V("monthly")]),await q(m.value))}async function V(u){try{const k=await Z.getUserModelStats(p.value,u);if(k.success){const P=k.data||[],F={requests:0,inputTokens:0,outputTokens:0,cacheCreateTokens:0,cacheReadTokens:0,allTokens:0,cost:0,formattedCost:"$0.000000"};P.forEach(O=>{var H;F.requests+=O.requests||0,F.inputTokens+=O.inputTokens||0,F.outputTokens+=O.outputTokens||0,F.cacheCreateTokens+=O.cacheCreateTokens||0,F.cacheReadTokens+=O.cacheReadTokens||0,F.allTokens+=O.allTokens||0,F.cost+=((H=O.costs)==null?void 0:H.total)||0}),F.formattedCost=X(F.cost),u==="daily"?L.value=F:y.value=F}else console.warn(`Failed to load ${u} stats:`,k.message)}catch(k){console.error(`Load ${u} stats error:`,k)}}async function q(u="daily"){if(p.value){f.value=!0;try{const k=await Z.getUserModelStats(p.value,u);if(k.success)h.value=k.data||[];else throw new Error(k.message||"加载模型统计失败")}catch(k){console.error("Load model stats error:",k),h.value=[]}finally{f.value=!1}}}async function $(u){if(!(m.value===u||f.value)){if(m.value=u,N.value&&_.value.length>0){await it(u);return}(u==="daily"&&!L.value||u==="monthly"&&!y.value)&&await V(u),await q(u)}}async function U(){var u,k;if(p.value){s.value=!0,g.value="",x.value=null,h.value=[];try{const P=await Z.getUserStats(p.value);if(P.success)x.value=P.data,console.log("API Stats - Full response:",P.data),console.log("API Stats - limits data:",P.data.limits),console.log("API Stats - weeklyOpusCostLimit:",(u=P.data.limits)==null?void 0:u.weeklyOpusCostLimit),console.log("API Stats - weeklyOpusCost:",(k=P.data.limits)==null?void 0:k.weeklyOpusCost),await B(),g.value="";else throw new Error(P.message||"查询失败")}catch(P){console.error("Load stats with apiId error:",P),g.value=P.message||"查询统计数据失败",x.value=null,h.value=[]}finally{s.value=!1}}}async function S(){d.value=!0;try{const u=await Z.getOemSettings();u&&u.success&&u.data&&(K.value={...K.value,...u.data})}catch(u){console.error("Error loading OEM settings:",u),K.value={siteName:"claude-relay-service",siteIcon:"",siteIconData:""}}finally{d.value=!1}}function X(u){return typeof u!="number"||u===0?"$0.000000":u>=1?"$"+u.toFixed(2):u>=.01?"$"+u.toFixed(4):"$"+u.toFixed(6)}function J(){if(p.value){const u=new URL(window.location);u.searchParams.set("apiId",p.value),window.history.pushState({},"",u)}}async function Y(){const u=o();if(u.length===0){g.value="请输入至少一个有效的 API Key";return}s.value=!0,g.value="",c.value=null,l.value=[],I.value=[],h.value=[],w.value=u,_.value=[];try{const k=await Promise.allSettled(u.map(H=>Z.getKeyId(H))),P=[],F=[];if(k.forEach((H,G)=>{H.status==="fulfilled"&&H.value.success?(P.push(H.value.data.id),F.push(u[G])):I.value.push(u[G])}),P.length===0)throw new Error("所有 API Key 都无效");_.value=P,w.value=F;const O=await Z.getBatchStats(P);if(O.success)c.value=O.data.aggregated,l.value=O.data.individual,x.value=O.data.aggregated,L.value=O.data.aggregated.dailyUsage||null,y.value=O.data.aggregated.monthlyUsage||null,await it(m.value),a();else throw new Error(O.message||"批量查询失败")}catch(k){console.error("Batch query error:",k),g.value=k.message||"批量查询统计数据失败",c.value=null,l.value=[]}finally{s.value=!1}}async function it(u="daily"){if(_.value.length!==0){f.value=!0;try{const k=await Z.getBatchModelStats(_.value,u);if(k.success)h.value=k.data||[];else throw new Error(k.message||"加载批量模型统计失败")}catch(k){console.error("Load batch model stats error:",k),h.value=[]}finally{f.value=!1}}}function o(){if(!R.value)return[];const u=R.value.split(/[,\n]+/).map(P=>P.trim()).filter(P=>P.length>=10&&P.length<=512);return[...new Set(u)].slice(0,30)}function a(){if(_.value.length>0){const u=new URL(window.location);u.searchParams.set("apiIds",_.value.join(",")),u.searchParams.set("batch","true"),window.history.pushState({},"",u)}}function C(){R.value=""}function T(){x.value=null,h.value=[],L.value=null,y.value=null,g.value="",m.value="daily",p.value=null,w.value=[],_.value=[],c.value=null,l.value=[],I.value=[]}function v(){R.value="",N.value=!1,T()}return{apiKey:R,apiId:p,loading:s,modelStatsLoading:f,oemLoading:d,error:g,statsPeriod:m,statsData:x,modelStats:h,dailyStats:L,monthlyStats:y,oemSettings:K,multiKeyMode:N,apiKeys:w,apiIds:_,aggregatedStats:c,individualStats:l,invalidKeys:I,currentPeriodData:E,usagePercentages:Q,queryStats:z,queryBatchStats:Y,loadAllPeriodStats:B,loadPeriodStats:V,loadModelStats:q,loadBatchModelStats:it,switchPeriod:$,loadStatsWithApiId:U,loadOemSettings:S,clearData:T,clearInput:C,reset:v}}),qt={class:"api-input-wide-card mb-8 rounded-3xl p-6 shadow-xl"},jt={class:"mx-auto max-w-4xl"},Ut={class:"control-bar mb-4 flex flex-wrap items-center justify-between gap-3"},Rt={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},Nt={class:"button-group flex items-center gap-2"},Ot={class:"mode-switch-group flex items-center rounded-lg bg-gray-100 p-1 dark:bg-gray-800"},Et={key:0,class:"ml-1 rounded-full bg-white/20 px-1.5 py-0.5 text-xs font-semibold"},Ft={class:"api-input-grid grid grid-cols-1 gap-4 lg:grid-cols-4"},Wt={class:"lg:col-span-3"},Bt=["disabled"],Vt={key:1,class:"relative"},zt=["disabled"],Jt={class:"lg:col-span-1"},Ht=["disabled"],Yt={key:0,class:"fas fa-spinner loading-spinner"},Gt={key:1,class:"fas fa-search"},Qt={class:"security-notice mt-4"},Xt={key:0,class:"mt-2 rounded-lg bg-primary-50 p-3 text-sm text-primary-700 dark:bg-primary-900/20 dark:text-primary-400"},Zt={__name:"ApiKeyInput",setup(R){const p=rt(),{apiKey:s,loading:f,multiKeyMode:d}=st(p),{queryStats:g,clearInput:m}=p,x=j(()=>{if(!d.value||!s.value)return[];const L=s.value.split(/[,\n]+/).map(K=>K.trim()).filter(K=>K.length>0);return[...new Set(L)].slice(0,30)}),h=j(()=>d.value?x.value.length>0:s.value&&s.value.trim().length>0);return(L,y)=>(r(),n("div",qt,[y[15]||(y[15]=t("div",{class:"wide-card-title mb-6"},[t("h2",{class:"mb-2 text-2xl font-bold text-gray-900 dark:text-gray-200"},[t("i",{class:"fas fa-chart-line mr-3"}),b(" 使用统计查询 ")]),t("p",{class:"text-base text-gray-600 dark:text-gray-400"},"查询您的 API Key 使用情况和统计数据")],-1)),t("div",jt,[t("div",Ut,[t("label",Rt,[y[8]||(y[8]=t("i",{class:"fas fa-key mr-2"},null,-1)),b(" "+i(e(d)?"输入您的 API Keys（每行一个或用逗号分隔）":"输入您的 API Key"),1)]),t("div",Nt,[t("div",Ot,[t("button",{class:M(["mode-switch-btn",{active:!e(d)}]),title:"单一模式",onClick:y[0]||(y[0]=K=>d.value=!1)},y[9]||(y[9]=[t("i",{class:"fas fa-key"},null,-1),t("span",{class:"ml-2 hidden sm:inline"},"单一",-1)]),2),t("button",{class:M(["mode-switch-btn",{active:e(d)}]),title:"聚合模式",onClick:y[1]||(y[1]=K=>d.value=!0)},[y[10]||(y[10]=t("i",{class:"fas fa-layer-group"},null,-1)),y[11]||(y[11]=t("span",{class:"ml-2 hidden sm:inline"},"聚合",-1)),e(d)&&x.value.length>0?(r(),n("span",Et,i(x.value.length),1)):A("",!0)],2)])])]),t("div",Ft,[t("div",Wt,[e(d)?(r(),n("div",Vt,[gt(t("textarea",{"onUpdate:modelValue":y[4]||(y[4]=K=>ft(s)?s.value=K:null),class:"wide-card-input w-full resize-y",disabled:e(f),placeholder:`请输入您的 API Keys，支持以下格式：
cr_xxx
cr_yyy
或
cr_xxx, cr_yyy`,rows:"4",onKeyup:y[5]||(y[5]=xt(kt((...K)=>e(g)&&e(g)(...K),["ctrl"]),["enter"]))},null,40,zt),[[yt,e(s)]]),e(s)&&!e(f)?(r(),n("button",{key:0,class:"absolute right-2 top-2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",title:"清空输入",onClick:y[6]||(y[6]=(...K)=>e(m)&&e(m)(...K))},y[12]||(y[12]=[t("i",{class:"fas fa-times-circle"},null,-1)]))):A("",!0)])):gt((r(),n("input",{key:0,"onUpdate:modelValue":y[2]||(y[2]=K=>ft(s)?s.value=K:null),class:"wide-card-input w-full",disabled:e(f),placeholder:"请输入您的 API Key (cr_...)",type:"password",onKeyup:y[3]||(y[3]=xt((...K)=>e(g)&&e(g)(...K),["enter"]))},null,40,Bt)),[[yt,e(s)]])]),t("div",Jt,[t("button",{class:"btn btn-primary btn-query flex h-full w-full items-center justify-center gap-2",disabled:e(f)||!h.value,onClick:y[7]||(y[7]=(...K)=>e(g)&&e(g)(...K))},[e(f)?(r(),n("i",Yt)):(r(),n("i",Gt)),b(" "+i(e(f)?"查询中...":"查询统计"),1)],8,Ht)])]),t("div",Qt,[y[13]||(y[13]=t("i",{class:"fas fa-shield-alt mr-2"},null,-1)),b(" "+i(e(d)?"您的 API Keys 仅用于查询统计数据，不会被存储。聚合模式下部分个体化信息将不显示。":"您的 API Key 仅用于查询自己的统计数据，不会被存储或用于其他用途"),1)]),e(d)?(r(),n("div",Xt,y[14]||(y[14]=[t("i",{class:"fas fa-lightbulb mr-2"},null,-1),t("span",null,"提示：最多支持同时查询 30 个 API Keys。使用 Ctrl+Enter 快速查询。",-1)]))):A("",!0)])]))}},te=at(Zt,[["__scopeId","data-v-4c1e729b"]]),ee={class:"space-y-6 md:space-y-8"},se={class:"grid grid-cols-1 items-stretch gap-4 md:gap-6 xl:grid-cols-[minmax(0,1.5fr)_minmax(0,1fr)]"},ae={class:"card-section"},re={key:0,class:"info-grid"},ie={class:"info-item"},le={class:"info-value"},oe={class:"info-item"},ne={class:"info-value text-green-600 dark:text-emerald-400"},de={key:0,class:"info-item"},ce={class:"info-value text-red-500 dark:text-red-400"},ue={class:"info-item"},me={class:"info-value"},ge={class:"info-item"},ye={class:"info-value"},xe={class:"info-item"},fe={class:"info-value text-secondary-600 dark:text-secondary-300"},pe={key:1,class:"info-item xl:col-span-2"},ve={class:"space-y-2"},be={class:"truncate"},ke={class:"font-semibold"},_e={key:1,class:"info-grid"},he={class:"info-item"},we={class:"info-value break-all"},$e={class:"info-item"},Se={class:"info-item"},Ce={class:"info-value"},Te={class:"info-item"},Ke={class:"info-value break-all"},Ae={class:"info-item xl:col-span-2"},Le={class:"info-value"},Pe={class:"ml-2 text-xs text-gray-500 dark:text-gray-400"},Ie={key:0,class:"text-red-500 dark:text-red-400"},Me={key:1,class:"text-orange-500 dark:text-orange-400"},De={key:2},qe={key:2,class:"text-gray-400 dark:text-gray-500"},je={class:"card-section"},Ue={class:"metric-grid"},Re={class:"metric-card"},Ne={class:"metric-value text-green-600 dark:text-emerald-300"},Oe={class:"metric-label"},Ee={class:"metric-card"},Fe={class:"metric-value text-primary-600 dark:text-primary-300"},We={class:"metric-label"},Be={class:"metric-card"},Ve={class:"metric-value text-magenta-600 dark:text-magenta-300"},ze={class:"metric-label"},Je={class:"metric-card"},He={class:"metric-value text-amber-500 dark:text-amber-300"},Ye={class:"metric-label"},Ge={key:0,class:"card-section"},Qe={class:"flex items-center justify-between gap-3"},Xe={class:"flex items-center gap-3"},Ze={class:"account-name"},ts={class:"account-sub"},es={key:0,class:"mt-3 space-y-2"},ss={class:"progress-row"},as={class:"progress-track"},rs={class:"progress-value"},is={class:"flex flex-wrap items-center gap-2 text-xs text-gray-600 dark:text-gray-300"},ls={key:0,class:"font-medium text-secondary-600 dark:text-secondary-400"},os={key:1,class:"mt-3"},ns={key:0,class:"space-y-2"},ds={class:"quota-header"},cs={class:"quota-percent"},us={class:"progress-track"},ms={class:"quota-foot"},gs={key:1,class:"rounded-xl bg-slate-100 px-3 py-2 text-xs text-slate-500 dark:bg-slate-800 dark:text-slate-300"},ys={__name:"StatsOverview",setup(R){const p=rt(),{statsData:s,statsPeriod:f,currentPeriodData:d,multiKeyMode:g,aggregatedStats:m,individualStats:x,invalidKeys:h}=st(p),L=j(()=>!x.value||x.value.length===0?[]:[...x.value].sort((o,a)=>{var C,T;return(((C=a.usage)==null?void 0:C.allTokens)||0)-(((T=o.usage)==null?void 0:T.allTokens)||0)}).slice(0,3)),y=o=>{var C;return!m.value||!m.value.usage.allTokens?0:((((C=o.usage)==null?void 0:C.allTokens)||0)/m.value.usage.allTokens*100).toFixed(1)},K=o=>{if(!o)return"无";try{return Pt(o).format("YYYY年MM月DD日 HH:mm")}catch{return"格式错误"}},N=o=>o?new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",w=o=>o?new Date(o)<new Date:!1,_=o=>{if(!o)return!1;const T=(new Date(o)-new Date)/(1e3*60*60*24);return T>0&&T<=7},c=o=>(typeof o!="number"&&(o=parseInt(o)||0),o===0?"0":o>=1e6?(o/1e6).toFixed(1)+"M":o>=1e3?(o/1e3).toFixed(1)+"K":o.toLocaleString()),l=o=>({claude:"Claude",gemini:"Gemini",all:"全部模型"})[o]||o||"未知",I=j(()=>{var C,T;const o=(T=(C=s.value)==null?void 0:C.accounts)==null?void 0:T.details;if(!o)return[];const a=[];return o.claude&&o.claude.accountType==="dedicated"&&a.push({key:"claude",...o.claude}),o.openai&&o.openai.accountType==="dedicated"&&a.push({key:"openai",...o.openai}),a}),E=j(()=>{const o=I.value.length;return o<=1?"md:grid-cols-1 lg:grid-cols-1":o===2?"md:grid-cols-2":"md:grid-cols-2 xl:grid-cols-3"}),Q=o=>o?o.platform==="openai"?"OpenAI 专属账号":"Claude 专属账号":"专属账号",z=o=>{if(!o||o<=0)return"";const a=Math.floor(o),C=Math.floor(a/1440),T=Math.floor(a%1440/60),v=a%60;return C>0?T>0?`${C}天${T}小时`:`${C}天`:T>0?v>0?`${T}小时${v}分钟`:`${T}小时`:`${v}分钟`},B=o=>{if(!o)return{text:"状态未知",class:"text-gray-400"};if(o.isRateLimited){const a=z(o.minutesRemaining);return{text:`限流中${a?` · 剩余约 ${a}`:""}`,class:"text-red-500 dark:text-red-400"}}return{text:"未限流",class:"text-green-600 dark:text-emerald-400"}},V=(o,a)=>{if(!o||!a)return"暂无时间窗口信息";const C=new Date(o),T=new Date(a),v=u=>`${`${u.getHours()}`.padStart(2,"0")}:${`${u.getMinutes()}`.padStart(2,"0")}`;return`${v(C)} - ${v(T)}`},q=o=>{if(!o||o<=0)return"";const a=Math.floor(o/60),C=o%60;return a>0?`${a}小时${C}分钟`:`${C}分钟`},$=(o,a)=>{var T;if(!o)return"bg-gradient-to-r from-primary-500 to-secondary-500";if((T=a==null?void 0:a.rateLimitStatus)!=null&&T.isRateLimited)return"bg-gradient-to-r from-red-500 to-red-600";const C=String(o).toLowerCase();return C==="rejected"?"bg-gradient-to-r from-red-500 to-red-600":C==="allowed_warning"?"bg-gradient-to-r from-yellow-500 to-orange-500":"bg-gradient-to-r from-primary-500 to-secondary-500"},U=o=>{if(!o)return null;const a=typeof o.usedPercent=="number"&&!Number.isNaN(o.usedPercent)?o.usedPercent:null,C=typeof o.resetAfterSeconds=="number"&&!Number.isNaN(o.resetAfterSeconds)?o.resetAfterSeconds:null,T=typeof o.remainingSeconds=="number"?o.remainingSeconds:null,v=o.resetAt?Date.parse(o.resetAt):null;return C!==null&&(T!==null&&T<=0||v!==null&&!Number.isNaN(v)&&Date.now()>=v)?0:a===null?null:Math.max(0,Math.min(100,a))},S=o=>{const a=U(o);return a===null?"bg-gradient-to-r from-gray-300 to-gray-400":a>=90?"bg-gradient-to-r from-red-500 to-red-600":a>=75?"bg-gradient-to-r from-yellow-500 to-orange-500":"bg-gradient-to-r from-emerald-500 to-teal-500"},X=o=>{const a=U(o);return a===null?"0%":`${a}%`},J=o=>{const a=U(o);return a===null?"--":`${a.toFixed(1)}%`},Y=o=>{if(!o)return"--";let a=o.remainingSeconds;if(a==null&&(a=o.resetAfterSeconds),a==null||Number.isNaN(Number(a)))return"--";a=Math.max(0,Math.floor(Number(a)));const C=Math.floor(a/86400),T=Math.floor(a%86400/3600),v=Math.floor(a%3600/60),u=a%60;return C>0?T>0?`${C}天${T}小时`:`${C}天`:T>0?v>0?`${T}小时${v}分钟`:`${T}小时`:v>0?`${v}分钟`:`${u}秒`},it=o=>o==="secondary"?"周限":"5h";return(o,a)=>{const C=Lt,T=At;return r(),n("div",ee,[t("div",se,[t("div",ae,[W(C,{icon:e(g)?"fas fa-layer-group":"fas fa-info-circle",title:e(g)?"批量查询概要":"API Key 信息",variant:e(g)?"magenta":"primary"},null,8,["icon","title","variant"]),e(g)&&e(m)?(r(),n("div",re,[t("div",ie,[a[0]||(a[0]=t("p",{class:"info-label"},"查询 Keys 数",-1)),t("p",le,i(e(m).totalKeys)+" 个",1)]),t("div",oe,[a[2]||(a[2]=t("p",{class:"info-label"},"有效 Keys 数",-1)),t("p",ne,[a[1]||(a[1]=t("i",{class:"fas fa-check-circle mr-1"},null,-1)),b(i(e(m).activeKeys)+" 个 ",1)])]),e(h).length>0?(r(),n("div",de,[a[4]||(a[4]=t("p",{class:"info-label"},"无效 Keys 数",-1)),t("p",ce,[a[3]||(a[3]=t("i",{class:"fas fa-times-circle mr-1"},null,-1)),b(i(e(h).length)+" 个 ",1)])])):A("",!0),t("div",ue,[a[5]||(a[5]=t("p",{class:"info-label"},"总请求数",-1)),t("p",me,i(c(e(m).usage.requests)),1)]),t("div",ge,[a[6]||(a[6]=t("p",{class:"info-label"},"总 Token 数",-1)),t("p",ye,i(c(e(m).usage.allTokens)),1)]),t("div",xe,[a[7]||(a[7]=t("p",{class:"info-label"},"总费用",-1)),t("p",fe,i(e(m).usage.formattedCost),1)]),e(x).length>1?(r(),n("div",pe,[a[8]||(a[8]=t("p",{class:"info-label"},"Top 3 贡献占比",-1)),t("div",ve,[(r(!0),n(tt,null,et(L.value,v=>(r(),n("div",{key:v.apiId,class:"contributor-item"},[t("span",be,i(v.name),1),t("span",ke,i(y(v))+"%",1)]))),128))])])):A("",!0)])):(r(),n("div",_e,[t("div",he,[a[9]||(a[9]=t("p",{class:"info-label"},"名称",-1)),t("p",we,i(e(s).name),1)]),t("div",$e,[a[10]||(a[10]=t("p",{class:"info-label"},"状态",-1)),t("p",{class:M(["info-value font-semibold",e(s).isActive?"text-green-600 dark:text-emerald-400":"text-red-500 dark:text-red-400"])},[t("i",{class:M(["mr-1",e(s).isActive?"fas fa-check-circle":"fas fa-times-circle"])},null,2),b(" "+i(e(s).isActive?"活跃":"已停用"),1)],2)]),t("div",Se,[a[11]||(a[11]=t("p",{class:"info-label"},"权限",-1)),t("p",Ce,i(l(e(s).permissions)),1)]),t("div",Te,[a[12]||(a[12]=t("p",{class:"info-label"},"创建时间",-1)),t("p",Ke,i(K(e(s).createdAt)),1)]),t("div",Ae,[a[17]||(a[17]=t("p",{class:"info-label"},"过期时间",-1)),t("div",Le,[e(s).expirationMode==="activation"&&!e(s).isActivated?(r(),n(tt,{key:0},[a[13]||(a[13]=t("span",{class:"text-amber-600 dark:text-amber-400"},[t("i",{class:"fas fa-pause-circle mr-1"}),b("未激活 ")],-1)),t("span",Pe," 首次使用后 "+i(e(s).activationDays||(e(s).activationUnit==="hours"?24:30))+" "+i(e(s).activationUnit==="hours"?"小时":"天")+"过期 ",1)],64)):e(s).expiresAt?(r(),n(tt,{key:1},[w(e(s).expiresAt)?(r(),n("span",Ie,a[14]||(a[14]=[t("i",{class:"fas fa-exclamation-circle mr-1"},null,-1),b("已过期 ",-1)]))):_(e(s).expiresAt)?(r(),n("span",Me,[a[15]||(a[15]=t("i",{class:"fas fa-clock mr-1"},null,-1)),b(i(N(e(s).expiresAt)),1)])):(r(),n("span",De,i(N(e(s).expiresAt)),1))],64)):(r(),n("span",qe,a[16]||(a[16]=[t("i",{class:"fas fa-infinity mr-1"},null,-1),b("永不过期 ",-1)])))])])]))]),t("div",je,[W(C,{icon:"fas fa-chart-bar",title:"使用统计概览",variant:"success"},{actions:lt(()=>[W(T,{variant:"neutral"},{default:lt(()=>[b(i(e(f)==="daily"?"今日":"本月"),1)]),_:1})]),_:1}),t("div",Ue,[t("div",Re,[t("p",Ne,i(c(e(d).requests)),1),t("p",Oe,i(e(f)==="daily"?"今日":"本月")+"请求数",1)]),t("div",Ee,[t("p",Fe,i(c(e(d).allTokens)),1),t("p",We,i(e(f)==="daily"?"今日":"本月")+"Token 数",1)]),t("div",Be,[t("p",Ve,i(e(d).formattedCost||"$0.000000"),1),t("p",ze,i(e(f)==="daily"?"今日":"本月")+"费用",1)]),t("div",Je,[t("p",He,i(c(e(d).inputTokens)),1),t("p",Ye,i(e(f)==="daily"?"今日":"本月")+"输入 Token",1)])])])]),!e(g)&&I.value.length>0?(r(),n("div",Ge,[W(C,{icon:"fas fa-plug",title:"专属账号运行状态",variant:"secondary"},{actions:lt(()=>[W(T,{variant:"accent"},{default:lt(()=>a[18]||(a[18]=[b("实时更新",-1)])),_:1,__:[18]})]),_:1}),t("div",{class:M(["grid grid-cols-1 gap-4",E.value])},[(r(!0),n(tt,null,et(I.value,v=>{var u,k,P,F,O,H;return r(),n("div",{key:v.id||v.key,class:"account-card"},[t("div",Qe,[t("div",Xe,[t("span",{class:M(["account-icon",v.platform==="claude"?"icon-claude":"icon-openai"])},[t("i",{class:M(v.platform==="claude"?"fas fa-meteor":"fas fa-robot")},null,2)],2),t("div",null,[t("p",Ze,i(Q(v)),1),t("p",ts,i(v.platform==="claude"?"会话窗口":"额度窗口"),1)])]),B(v.rateLimitStatus)?(r(),n("div",{key:0,class:M(["rate-badge",B(v.rateLimitStatus).class])},[a[19]||(a[19]=t("i",{class:"fas fa-tachometer-alt mr-1"},null,-1)),b(" "+i(B(v.rateLimitStatus).text),1)],2)):A("",!0)]),v.platform==="claude"?(r(),n("div",es,[t("div",ss,[t("div",as,[t("div",{class:M(["progress-bar",$((u=v.sessionWindow)==null?void 0:u.sessionWindowStatus,v)]),style:ot({width:`${Math.min(100,Math.max(0,((k=v.sessionWindow)==null?void 0:k.progress)||0))}%`})},null,6)]),t("span",rs,i(Math.min(100,Math.max(0,Math.round(((P=v.sessionWindow)==null?void 0:P.progress)||0))))+"% ",1)]),t("div",is,[t("span",null,i(V((F=v.sessionWindow)==null?void 0:F.windowStart,(O=v.sessionWindow)==null?void 0:O.windowEnd)),1),((H=v.sessionWindow)==null?void 0:H.remainingTime)>0?(r(),n("span",ls," 剩余 "+i(q(v.sessionWindow.remainingTime)),1)):A("",!0)])])):v.platform==="openai"?(r(),n("div",os,[v.codexUsage?(r(),n("div",ns,[(r(),n(tt,null,et(["primary","secondary"],G=>{var dt,ct,ut,mt;return t("div",{key:`${v.key}-${G}`,class:"quota-row"},[t("div",ds,[t("span",{class:M(["quota-tag",G==="primary"?"tag-indigo":"tag-blue"])},i(it(G)),3),t("span",cs,i(J((dt=v.codexUsage)==null?void 0:dt[G])),1)]),t("div",us,[t("div",{class:M(["progress-bar",S((ct=v.codexUsage)==null?void 0:ct[G])]),style:ot({width:X((ut=v.codexUsage)==null?void 0:ut[G])})},null,6)]),t("div",ms," 重置剩余 "+i(Y((mt=v.codexUsage)==null?void 0:mt[G])),1)])}),64))])):(r(),n("p",gs," 暂无额度使用数据 "))])):A("",!0)])}),128))],2)])):A("",!0)])}}},xs=at(ys,[["__scopeId","data-v-49b48d8f"]]),fs={class:"card p-4 md:p-6"},ps={class:"mb-3 flex flex-col text-lg font-bold text-gray-900 dark:text-gray-100 sm:flex-row sm:items-center md:mb-4 md:text-xl"},vs={class:"text-xs font-normal text-gray-600 dark:text-gray-400 sm:ml-2 md:text-sm"},bs={class:"space-y-2 md:space-y-3"},ks={class:"flex items-center justify-between"},_s={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},hs={class:"flex items-center justify-between"},ws={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},$s={class:"flex items-center justify-between"},Ss={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},Cs={class:"flex items-center justify-between"},Ts={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},Ks={class:"mt-3 border-t border-gray-200 pt-3 dark:border-gray-700 md:mt-4 md:pt-4"},As={class:"flex items-center justify-between font-bold text-gray-900 dark:text-gray-100"},Ls={class:"text-sm md:text-base"},Ps={class:"text-lg md:text-xl"},Is={__name:"TokenDistribution",setup(R){const p=rt(),{statsPeriod:s,currentPeriodData:f}=st(p),d=g=>(typeof g!="number"&&(g=parseInt(g)||0),g===0?"0":g>=1e6?(g/1e6).toFixed(1)+"M":g>=1e3?(g/1e3).toFixed(1)+"K":g.toLocaleString());return(g,m)=>(r(),n("div",fs,[t("h3",ps,[m[0]||(m[0]=t("span",{class:"flex items-center"},[t("i",{class:"fas fa-coins mr-2 text-sm text-yellow-500 md:mr-3 md:text-base"}),b(" Token 使用分布 ")],-1)),t("span",vs,"("+i(e(s)==="daily"?"今日":"本月")+")",1)]),t("div",bs,[t("div",ks,[m[1]||(m[1]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-arrow-right mr-1 text-xs text-green-500 md:mr-2 md:text-sm"}),b(" 输入 Token ")],-1)),t("span",_s,i(d(e(f).inputTokens)),1)]),t("div",hs,[m[2]||(m[2]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-arrow-left mr-1 text-xs text-primary-500 md:mr-2 md:text-sm"}),b(" 输出 Token ")],-1)),t("span",ws,i(d(e(f).outputTokens)),1)]),t("div",$s,[m[3]||(m[3]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-save mr-1 text-xs text-magenta-500 md:mr-2 md:text-sm"}),b(" 缓存创建 Token ")],-1)),t("span",Ss,i(d(e(f).cacheCreateTokens)),1)]),t("div",Cs,[m[4]||(m[4]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-download mr-1 text-xs text-orange-500 md:mr-2 md:text-sm"}),b(" 缓存读取 Token ")],-1)),t("span",Ts,i(d(e(f).cacheReadTokens)),1)])]),t("div",Ks,[t("div",As,[t("span",Ls,i(e(s)==="daily"?"今日":"本月")+"总计",1),t("span",Ps,i(d(e(f).allTokens)),1)])])]))}},Ms=at(Is,[["__scopeId","data-v-69410c71"]]),Ds={class:"flex h-full flex-col gap-4 md:gap-6"},qs={class:"card flex h-full flex-col p-4 md:p-6"},js={class:"mb-3 flex items-center text-lg font-bold text-gray-900 dark:text-gray-100 md:mb-4 md:text-xl"},Us={key:0,class:"space-y-4"},Rs={class:"rounded-lg bg-gradient-to-r from-primary-50 to-secondary-50 p-4 dark:from-primary-900/20 dark:to-secondary-900/20"},Ns={class:"mb-3 flex items-center justify-between"},Os={class:"rounded-full bg-primary-100 px-2 py-1 text-xs font-semibold text-primary-700 dark:bg-primary-800 dark:text-primary-200"},Es={class:"grid grid-cols-2 gap-3"},Fs={class:"text-center"},Ws={class:"text-lg font-bold text-gray-900 dark:text-gray-100"},Bs={class:"text-center"},Vs={class:"text-lg font-bold text-green-600"},zs={class:"rounded-lg bg-gradient-to-r from-magenta-50 to-magenta-100 p-4 dark:from-magenta-900/20 dark:to-magenta-900/30"},Js={class:"space-y-2"},Hs={class:"flex items-center justify-between"},Ys={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Gs={class:"flex items-center justify-between"},Qs={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Xs={class:"flex items-center justify-between"},Zs={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},ta={key:0,class:"rounded-lg bg-red-50 p-3 text-sm dark:bg-red-900/20"},ea={class:"text-red-700 dark:text-red-300"},sa={key:1,class:"space-y-4 md:space-y-5"},aa={class:"mb-2 flex items-center justify-between"},ra={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},ia={key:0},la={key:1,class:"flex items-center gap-1"},oa={key:0,class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},na={key:1,class:"h-2 w-full rounded-full bg-gray-200"},da={class:"mb-2 flex items-center justify-between"},ca={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},ua={key:0},ma={key:1,class:"flex items-center gap-1"},ga={key:0,class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},ya={key:1,class:"h-2 w-full rounded-full bg-gray-200"},xa={key:0},fa={class:"mb-2 flex items-center justify-between"},pa={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},va={class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},ba={key:1},ka={class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},_a={key:0},ha={key:1},wa={key:2},$a={class:"space-y-4 border-t border-gray-100 pt-3 dark:border-gray-700"},Sa={class:"flex items-center justify-between"},Ca={class:"text-sm font-medium text-gray-900 md:text-base"},Ta={key:0},Ka={key:1,class:"flex items-center gap-1"},Aa={class:"flex items-center justify-between"},La={class:"text-sm font-medium text-gray-900 md:text-base"},Pa={key:0,class:"text-orange-600"},Ia={key:1,class:"text-green-600"},Ma={class:"space-y-2"},Da={class:"flex items-center justify-between"},qa={class:"text-sm font-medium text-gray-900 md:text-base"},ja={key:0,class:"text-orange-600"},Ua={key:1,class:"text-green-600"},Ra={key:0,class:"flex flex-wrap gap-2 rounded-lg bg-primary-50 p-2 dark:bg-primary-900/20 md:p-3"},Na={key:0,class:"card !overflow-visible p-4 md:p-6"},Oa={class:"rounded-lg border border-amber-200 bg-amber-50 p-3 dark:border-amber-800 dark:bg-amber-900/20 md:p-4"},Ea={class:"max-h-64 space-y-1 overflow-y-auto pr-1 md:max-h-80 md:space-y-2"},Fa={class:"break-all text-gray-800 dark:text-gray-200"},Wa={__name:"LimitConfig",setup(R){const p=rt(),{statsData:s,multiKeyMode:f,aggregatedStats:d,invalidKeys:g}=st(p),m=j(()=>{var l;const c=(l=s.value)==null?void 0:l.restrictions;return c?c.enableModelRestriction===!0&&Array.isArray(c.restrictedModels)&&c.restrictedModels.length>0:!1}),x=j(()=>{var l;const c=(l=s.value)==null?void 0:l.restrictions;return c?c.enableClientRestriction===!0&&Array.isArray(c.allowedClients)&&c.allowedClients.length>0:!1}),h=()=>{if(!s.value.limits.dailyCostLimit||s.value.limits.dailyCostLimit===0)return 0;const c=s.value.limits.currentDailyCost/s.value.limits.dailyCostLimit*100;return Math.min(c,100)},L=()=>{const c=h();return c>=100?"bg-red-500":c>=80?"bg-yellow-500":"bg-green-500"},y=()=>{if(!s.value.limits.totalCostLimit||s.value.limits.totalCostLimit===0)return 0;const c=s.value.limits.currentTotalCost/s.value.limits.totalCostLimit*100;return Math.min(c,100)},K=()=>{const c=y();return c>=100?"bg-red-500":c>=80?"bg-yellow-500":"bg-primary-500"},N=()=>{if(!s.value.limits.weeklyOpusCostLimit||s.value.limits.weeklyOpusCostLimit===0)return 0;const c=s.value.limits.weeklyOpusCost/s.value.limits.weeklyOpusCostLimit*100;return Math.min(c,100)},w=()=>{const c=N();return c>=100?"bg-red-500":c>=80?"bg-yellow-500":"bg-secondary-500"},_=c=>(typeof c!="number"&&(c=parseInt(c)||0),c===0?"0":c>=1e6?(c/1e6).toFixed(1)+"M":c>=1e3?(c/1e3).toFixed(1)+"K":c.toLocaleString());return(c,l)=>(r(),n("div",Ds,[t("div",qs,[t("h3",js,[l[0]||(l[0]=t("i",{class:"fas fa-shield-alt mr-2 text-sm text-red-500 md:mr-3 md:text-base"},null,-1)),b(" "+i(e(f)?"限制配置（聚合查询模式）":"限制配置"),1)]),e(f)&&e(d)?(r(),n("div",Us,[t("div",Rs,[t("div",Ns,[l[1]||(l[1]=t("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},[t("i",{class:"fas fa-layer-group mr-2 text-primary-500"}),b(" API Keys 概况 ")],-1)),t("span",Os,i(e(d).activeKeys)+"/"+i(e(d).totalKeys),1)]),t("div",Es,[t("div",Fs,[t("div",Ws,i(e(d).totalKeys),1),l[2]||(l[2]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"总计 Keys",-1))]),t("div",Bs,[t("div",Vs,i(e(d).activeKeys),1),l[3]||(l[3]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"激活 Keys",-1))])])]),t("div",zs,[l[7]||(l[7]=t("div",{class:"mb-3 flex items-center"},[t("i",{class:"fas fa-chart-pie mr-2 text-magenta-500"}),t("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"聚合统计摘要")],-1)),t("div",Js,[t("div",Hs,[l[4]||(l[4]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[t("i",{class:"fas fa-database mr-1 text-gray-400"}),b(" 总请求数 ")],-1)),t("span",Ys,i(_(e(d).usage.requests)),1)]),t("div",Gs,[l[5]||(l[5]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[t("i",{class:"fas fa-coins mr-1 text-yellow-500"}),b(" 总 Tokens ")],-1)),t("span",Qs,i(_(e(d).usage.allTokens)),1)]),t("div",Xs,[l[6]||(l[6]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[t("i",{class:"fas fa-dollar-sign mr-1 text-green-500"}),b(" 总费用 ")],-1)),t("span",Zs,i(e(d).usage.formattedCost),1)])])]),e(g)&&e(g).length>0?(r(),n("div",ta,[l[8]||(l[8]=t("i",{class:"fas fa-exclamation-triangle mr-2 text-red-600 dark:text-red-400"},null,-1)),t("span",ea,i(e(g).length)+" 个无效的 API Key ",1)])):A("",!0),l[9]||(l[9]=t("div",{class:"rounded-lg bg-gray-50 p-3 text-xs text-gray-600 dark:bg-gray-800 dark:text-gray-400"},[t("i",{class:"fas fa-info-circle mr-1"}),b(" 每个 API Key 有独立的限制设置，聚合模式下不显示单个限制配置 ")],-1))])):A("",!0),e(f)?A("",!0):(r(),n("div",sa,[t("div",null,[t("div",aa,[l[11]||(l[11]=t("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"每日费用限制",-1)),t("span",ra,[e(s).limits.dailyCostLimit>0?(r(),n("span",ia," $"+i(e(s).limits.currentDailyCost.toFixed(4))+" / $"+i(e(s).limits.dailyCostLimit.toFixed(2)),1)):(r(),n("span",la,[b(" $"+i(e(s).limits.currentDailyCost.toFixed(4))+" / ",1),l[10]||(l[10]=t("i",{class:"fas fa-infinity"},null,-1))]))])]),e(s).limits.dailyCostLimit>0?(r(),n("div",oa,[t("div",{class:M(["h-2 rounded-full transition-all duration-300",L()]),style:ot({width:h()+"%"})},null,6)])):(r(),n("div",na,l[12]||(l[12]=[t("div",{class:"h-2 rounded-full bg-green-500",style:{width:"0%"}},null,-1)])))]),t("div",null,[t("div",da,[l[14]||(l[14]=t("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"总费用限制",-1)),t("span",ca,[e(s).limits.totalCostLimit>0?(r(),n("span",ua," $"+i(e(s).limits.currentTotalCost.toFixed(4))+" / $"+i(e(s).limits.totalCostLimit.toFixed(2)),1)):(r(),n("span",ma,[b(" $"+i(e(s).limits.currentTotalCost.toFixed(4))+" / ",1),l[13]||(l[13]=t("i",{class:"fas fa-infinity"},null,-1))]))])]),e(s).limits.totalCostLimit>0?(r(),n("div",ga,[t("div",{class:M(["h-2 rounded-full transition-all duration-300",K()]),style:ot({width:y()+"%"})},null,6)])):(r(),n("div",ya,l[15]||(l[15]=[t("div",{class:"h-2 rounded-full bg-primary-500",style:{width:"0%"}},null,-1)])))]),e(s).limits.weeklyOpusCostLimit>0?(r(),n("div",xa,[t("div",fa,[l[16]||(l[16]=t("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"Opus 模型周费用限制",-1)),t("span",pa," $"+i(e(s).limits.weeklyOpusCost.toFixed(4))+" / $"+i(e(s).limits.weeklyOpusCostLimit.toFixed(2)),1)]),t("div",va,[t("div",{class:M(["h-2 rounded-full transition-all duration-300",w()]),style:ot({width:N()+"%"})},null,6)])])):A("",!0),e(s).limits.rateLimitWindow>0&&(e(s).limits.rateLimitRequests>0||e(s).limits.tokenLimit>0||e(s).limits.rateLimitCost>0)?(r(),n("div",ba,[W(It,{"cost-limit":e(s).limits.rateLimitCost,"current-cost":e(s).limits.currentWindowCost,"current-requests":e(s).limits.currentWindowRequests,"current-tokens":e(s).limits.currentWindowTokens,label:"时间窗口限制","rate-limit-window":e(s).limits.rateLimitWindow,"request-limit":e(s).limits.rateLimitRequests,"show-progress":!0,"show-tooltip":!0,"token-limit":e(s).limits.tokenLimit,"window-end-time":e(s).limits.windowEndTime,"window-remaining-seconds":e(s).limits.windowRemainingSeconds,"window-start-time":e(s).limits.windowStartTime},null,8,["cost-limit","current-cost","current-requests","current-tokens","rate-limit-window","request-limit","token-limit","window-end-time","window-remaining-seconds","window-start-time"]),t("div",ka,[l[17]||(l[17]=t("i",{class:"fas fa-info-circle mr-1"},null,-1)),e(s).limits.rateLimitCost>0?(r(),n("span",_a,' 请求次数和费用限制为"或"的关系，任一达到限制即触发限流 ')):e(s).limits.tokenLimit>0?(r(),n("span",ha,' 请求次数和Token使用量为"或"的关系，任一达到限制即触发限流 ')):(r(),n("span",wa," 仅限制请求次数 "))])])):A("",!0),t("div",$a,[t("div",Sa,[l[19]||(l[19]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"并发限制",-1)),t("span",Ca,[e(s).limits.concurrencyLimit>0?(r(),n("span",Ta,i(e(s).limits.concurrencyLimit),1)):(r(),n("span",Ka,l[18]||(l[18]=[t("i",{class:"fas fa-infinity text-gray-400"},null,-1)])))])]),t("div",Aa,[l[22]||(l[22]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"模型限制",-1)),t("span",La,[m.value?(r(),n("span",Pa,[l[20]||(l[20]=t("i",{class:"fas fa-exclamation-triangle mr-1 text-xs md:text-sm"},null,-1)),b(" 限制 "+i(e(s).restrictions.restrictedModels.length)+" 个模型 ",1)])):(r(),n("span",Ia,l[21]||(l[21]=[t("i",{class:"fas fa-check-circle mr-1 text-xs md:text-sm"},null,-1),b(" 允许所有模型 ",-1)])))])]),t("div",Ma,[t("div",Da,[l[25]||(l[25]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"客户端限制",-1)),t("span",qa,[x.value?(r(),n("span",ja,[l[23]||(l[23]=t("i",{class:"fas fa-exclamation-triangle mr-1 text-xs md:text-sm"},null,-1)),b(" 限 "+i(e(s).restrictions.allowedClients.length)+" 种客户端使用 ",1)])):(r(),n("span",Ua,l[24]||(l[24]=[t("i",{class:"fas fa-check-circle mr-1 text-xs md:text-sm"},null,-1),b(" 允许所有客户端 ",-1)])))])]),x.value?(r(),n("div",Ra,[(r(!0),n(tt,null,et(e(s).restrictions.allowedClients,I=>(r(),n("span",{key:I,class:"flex items-center gap-1 rounded-full bg-white px-2 py-1 text-xs text-primary-700 shadow-sm dark:bg-slate-900 dark:text-primary-300 md:text-sm"},[l[26]||(l[26]=t("i",{class:"fas fa-id-badge"},null,-1)),b(" "+i(I),1)]))),128))])):A("",!0)])])]))]),m.value?(r(),n("div",Na,[l[30]||(l[30]=t("h3",{class:"mb-3 flex items-center text-lg font-bold text-gray-900 dark:text-gray-100 md:mb-4 md:text-xl"},[t("i",{class:"fas fa-list-alt mr-2 text-sm text-amber-500 md:mr-3 md:text-base"}),b(" 详细限制信息 ")],-1)),t("div",Oa,[l[28]||(l[28]=t("h4",{class:"mb-2 flex items-center text-sm font-bold text-amber-800 dark:text-amber-300 md:mb-3 md:text-base"},[t("i",{class:"fas fa-robot mr-1 text-xs md:mr-2 md:text-sm"}),b(" 受限模型列表 ")],-1)),t("div",Ea,[(r(!0),n(tt,null,et(e(s).restrictions.restrictedModels,I=>(r(),n("div",{key:I,class:"rounded border border-amber-200 bg-white px-2 py-1 text-xs dark:border-amber-700 dark:bg-gray-800 md:px-3 md:py-2 md:text-sm"},[l[27]||(l[27]=t("i",{class:"fas fa-ban mr-1 text-xs text-red-500 md:mr-2"},null,-1)),t("span",Fa,i(I),1)]))),128))]),l[29]||(l[29]=t("p",{class:"mt-2 text-xs text-amber-700 dark:text-amber-400 md:mt-3"},[t("i",{class:"fas fa-info-circle mr-1"}),b(" 此 API Key 不能访问以上列出的模型 ")],-1))])])):A("",!0)]))}},Ba=at(Wa,[["__scopeId","data-v-78a6bf2c"]]),Va={class:"card h-full p-4 md:p-6"},za={class:"mb-3 flex flex-col text-lg font-bold text-gray-900 dark:text-gray-100 sm:flex-row sm:items-center md:mb-4 md:text-xl"},Ja={class:"text-xs font-normal text-gray-600 dark:text-gray-400 sm:ml-2 md:text-sm"},Ha={key:0,class:"space-y-2 md:space-y-3"},Ya={class:"mb-1 flex items-center justify-between text-sm"},Ga={class:"truncate font-medium text-gray-700 dark:text-gray-300"},Qa={class:"text-xs text-gray-600 dark:text-gray-400"},Xa={class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},Za={class:"mt-1 flex items-center justify-between text-xs text-gray-500 dark:text-gray-400"},tr={key:0,class:"border-t border-gray-200 pt-2 dark:border-gray-700"},er={class:"flex items-center justify-between text-sm text-gray-600 dark:text-gray-400"},sr={key:1,class:"flex h-32 items-center justify-center text-sm text-gray-500 dark:text-gray-400"},ar={key:2,class:"flex h-32 items-center justify-center text-sm text-gray-500 dark:text-gray-400"},rr={__name:"AggregatedStatsCard",setup(R){const p=rt(),{aggregatedStats:s,individualStats:f,statsPeriod:d,multiKeyMode:g}=st(p),m=w=>w?d.value==="daily"?w.dailyUsage||w.usage:w.monthlyUsage||w.usage:null,x=j(()=>!f.value||f.value.length===0?[]:[...f.value].sort((w,_)=>{const c=m(w),l=m(_);return((l==null?void 0:l.cost)||0)-((c==null?void 0:c.cost)||0)}).slice(0,5)),h=j(()=>f.value?Math.max(0,f.value.length-5):0),L=j(()=>{var l,I;if(!f.value||!s.value)return 0;const w=x.value.reduce((E,Q)=>{const z=m(Q);return E+((z==null?void 0:z.cost)||0)},0),_=d.value==="daily"?((l=s.value.dailyUsage)==null?void 0:l.cost)||0:((I=s.value.monthlyUsage)==null?void 0:I.cost)||0;if(_===0)return 0;const c=_-w;return Math.max(0,Math.round(c/_*100))}),y=w=>{var I,E;if(!s.value)return 0;const _=d.value==="daily"?((I=s.value.dailyUsage)==null?void 0:I.cost)||0:((E=s.value.monthlyUsage)==null?void 0:E.cost)||0;if(_===0)return 0;const c=m(w),l=((c==null?void 0:c.cost)||0)/_*100;return Math.round(l)},K=w=>["bg-primary-500","bg-green-500","bg-magenta-500","bg-yellow-500","bg-pink-500"][w]||"bg-gray-400",N=w=>(typeof w!="number"&&(w=parseInt(w)||0),w===0?"0":w>=1e6?(w/1e6).toFixed(1)+"M":w>=1e3?(w/1e3).toFixed(1)+"K":w.toLocaleString());return(w,_)=>(r(),n("div",Va,[t("h3",za,[_[0]||(_[0]=t("span",{class:"flex items-center"},[t("i",{class:"fas fa-chart-pie mr-2 text-sm text-orange-500 md:mr-3 md:text-base"}),b(" 使用占比 ")],-1)),t("span",Ja,"("+i(e(d)==="daily"?"今日":"本月")+")",1)]),e(s)&&e(f).length>0?(r(),n("div",Ha,[(r(!0),n(tt,null,et(x.value,(c,l)=>{var I,E;return r(),n("div",{key:c.apiId,class:"relative"},[t("div",Ya,[t("span",Ga,i(c.name||`Key ${l+1}`),1),t("span",Qa,i(y(c))+"% ",1)]),t("div",Xa,[t("div",{class:M(["h-2 rounded-full transition-all duration-300",K(l)]),style:ot({width:y(c)+"%"})},null,6)]),t("div",Za,[t("span",null,i(N(((I=m(c))==null?void 0:I.requests)||0))+"次",1),t("span",null,i(((E=m(c))==null?void 0:E.formattedCost)||"$0.00"),1)])])}),128)),h.value>0?(r(),n("div",tr,[t("div",er,[t("span",null,"其他 "+i(h.value)+" 个Keys",1),t("span",null,i(L.value)+"%",1)])])):A("",!0)])):e(g)?(r(),n("div",ar,_[2]||(_[2]=[t("i",{class:"fas fa-chart-pie mr-2"},null,-1),b(" 暂无数据 ",-1)]))):(r(),n("div",sr,_[1]||(_[1]=[t("div",{class:"text-center"},[t("i",{class:"fas fa-chart-pie mb-2 text-2xl"}),t("p",null,"使用占比仅在多Key查询时显示")],-1)])))]))}},ir=at(rr,[["__scopeId","data-v-d2b0527e"]]),lr={class:"card p-4 md:p-6"},or={class:"mb-4 md:mb-6"},nr={class:"flex flex-col text-lg font-bold text-gray-900 dark:text-gray-100 sm:flex-row sm:items-center md:text-xl"},dr={class:"text-xs font-normal text-gray-600 dark:text-gray-400 sm:ml-2 md:text-sm"},cr={key:0,class:"py-6 text-center md:py-8"},ur={key:1,class:"space-y-3 md:space-y-4"},mr={class:"mb-2 flex items-start justify-between md:mb-3"},gr={class:"min-w-0 flex-1"},yr={class:"break-all text-base font-bold text-gray-900 dark:text-gray-100 md:text-lg"},xr={class:"text-xs text-gray-600 dark:text-gray-400 md:text-sm"},fr={class:"ml-3 flex-shrink-0 text-right"},pr={class:"text-base font-bold text-green-600 md:text-lg"},vr={class:"grid grid-cols-2 gap-2 text-xs md:grid-cols-4 md:gap-3 md:text-sm"},br={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},kr={class:"font-medium text-gray-900 dark:text-gray-100"},_r={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},hr={class:"font-medium text-gray-900 dark:text-gray-100"},wr={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},$r={class:"font-medium text-gray-900 dark:text-gray-100"},Sr={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},Cr={class:"font-medium text-gray-900 dark:text-gray-100"},Tr={key:2,class:"py-6 text-center text-gray-500 dark:text-gray-400 md:py-8"},Kr={class:"text-sm md:text-base"},Ar={__name:"ModelUsageStats",setup(R){const p=rt(),{statsPeriod:s,modelStats:f,modelStatsLoading:d}=st(p),g=m=>(typeof m!="number"&&(m=parseInt(m)||0),m===0?"0":m>=1e6?(m/1e6).toFixed(1)+"M":m>=1e3?(m/1e3).toFixed(1)+"K":m.toLocaleString());return(m,x)=>(r(),n("div",lr,[t("div",or,[t("h3",nr,[x[0]||(x[0]=t("span",{class:"flex items-center"},[t("i",{class:"fas fa-robot mr-2 text-sm text-secondary-500 md:mr-3 md:text-base"}),b(" 模型使用统计 ")],-1)),t("span",dr,"("+i(e(s)==="daily"?"今日":"本月")+")",1)])]),e(d)?(r(),n("div",cr,x[1]||(x[1]=[t("i",{class:"fas fa-spinner loading-spinner mb-2 text-xl text-gray-600 dark:text-gray-400 md:text-2xl"},null,-1),t("p",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"加载模型统计数据中...",-1)]))):e(f).length>0?(r(),n("div",ur,[(r(!0),n(tt,null,et(e(f),(h,L)=>{var y;return r(),n("div",{key:L,class:"model-usage-item"},[t("div",mr,[t("div",gr,[t("h4",yr,i(h.model),1),t("p",xr,i(h.requests)+" 次请求 ",1)]),t("div",fr,[t("div",pr,i(((y=h.formatted)==null?void 0:y.total)||"$0.000000"),1),x[2]||(x[2]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400 md:text-sm"},"总费用",-1))])]),t("div",vr,[t("div",br,[x[3]||(x[3]=t("div",{class:"text-gray-600 dark:text-gray-400"},"输入 Token",-1)),t("div",kr,i(g(h.inputTokens)),1)]),t("div",_r,[x[4]||(x[4]=t("div",{class:"text-gray-600 dark:text-gray-400"},"输出 Token",-1)),t("div",hr,i(g(h.outputTokens)),1)]),t("div",wr,[x[5]||(x[5]=t("div",{class:"text-gray-600 dark:text-gray-400"},"缓存创建",-1)),t("div",$r,i(g(h.cacheCreateTokens)),1)]),t("div",Sr,[x[6]||(x[6]=t("div",{class:"text-gray-600 dark:text-gray-400"},"缓存读取",-1)),t("div",Cr,i(g(h.cacheReadTokens)),1)])])])}),128))])):(r(),n("div",Tr,[x[7]||(x[7]=t("i",{class:"fas fa-chart-pie mb-3 text-2xl md:text-3xl"},null,-1)),t("p",Kr," 暂无"+i(e(s)==="daily"?"今日":"本月")+"模型使用数据 ",1)]))]))}},Lr=at(Ar,[["__scopeId","data-v-f0877cb5"]]),Pr={key:0,class:"fixed inset-0 z-[1050] flex items-center justify-center bg-gray-900/40 backdrop-blur-sm"},Ir={class:"relative z-10 mx-3 flex w-full max-w-lg flex-col overflow-hidden rounded-2xl border border-gray-200/70 bg-white/95 shadow-2xl ring-1 ring-black/5 transition-all dark:border-gray-700/60 dark:bg-gray-900/95 dark:ring-white/10 sm:mx-4"},Mr={class:"flex items-center justify-between border-b border-gray-100 bg-white/80 px-5 py-4 backdrop-blur dark:border-gray-800 dark:bg-gray-900/80"},Dr={class:"flex items-center gap-3"},qr={class:"text-xs text-gray-500 dark:text-gray-400"},jr=["disabled"],Ur={class:"max-h-[70vh] overflow-y-auto px-5 py-4"},Rr={class:"mb-4"},Nr={class:"relative"},Or=["value"],Er={class:"mb-4 space-y-2"},Fr={class:"flex items-center justify-between text-sm"},Wr={class:"font-medium text-gray-700 dark:text-gray-300"},Br={class:"flex items-center gap-3"},Vr={class:"text-xs text-gray-500 dark:text-gray-400"},zr={key:0,class:"mb-4 overflow-hidden rounded-xl border border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800/50"},Jr={class:"flex items-center justify-between border-b border-gray-200 bg-gray-100 px-3 py-2 dark:border-gray-700 dark:bg-gray-800"},Hr={key:0,class:"text-xs text-gray-500 dark:text-gray-500"},Yr={class:"max-h-40 overflow-y-auto p-3"},Gr={key:0,class:"whitespace-pre-wrap text-sm text-gray-700 dark:text-gray-300"},Qr={key:0,class:"inline-block h-4 w-1 animate-pulse bg-primary-500"},Xr={key:1,class:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400"},Zr={key:2,class:"text-sm text-red-600 dark:text-red-400"},ti={key:1,class:"mb-4 flex items-center justify-center gap-2 text-xs text-gray-500 dark:text-gray-400"},ei={class:"flex items-center justify-end gap-3 border-t border-gray-100 bg-gray-50/80 px-5 py-3 dark:border-gray-800 dark:bg-gray-900/50"},si=["disabled"],ai=["disabled"],ri={__name:"ApiKeyTestModal",props:{show:{type:Boolean,default:!1},apiKeyValue:{type:String,default:""},apiKeyName:{type:String,default:""}},emits:["close"],setup(R,{emit:p}){const s=R,f=p,d=D("idle"),g=D(""),m=D(""),x=D(0),h=D(null),L=D(null),y=D("claude-sonnet-4-5-20250929"),K=j(()=>s.apiKeyName||"当前 API Key"),N=j(()=>{const q=s.apiKeyValue;return q?q.length<=10?"****":q.substring(0,6)+"****"+q.substring(q.length-4):""}),w=j(()=>{switch(d.value){case"idle":return"准备就绪";case"testing":return"正在测试...";case"success":return"测试成功";case"error":return"测试失败";default:return"未知状态"}}),_=j(()=>{switch(d.value){case"idle":return"点击下方按钮开始测试 API Key 连通性";case"testing":return"正在通过 /api 端点发送测试请求";case"success":return"API Key 可以正常访问服务";case"error":return m.value||"无法通过 API Key 访问服务";default:return""}}),c=j(()=>{switch(d.value){case"idle":return"border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800/50";case"testing":return"border-primary-200 bg-primary-50 dark:border-primary-500/30 dark:bg-primary-900/20";case"success":return"border-green-200 bg-green-50 dark:border-green-500/30 dark:bg-green-900/20";case"error":return"border-red-200 bg-red-50 dark:border-red-500/30 dark:bg-red-900/20";default:return"border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800/50"}}),l=j(()=>{switch(d.value){case"idle":return"bg-gray-200 dark:bg-gray-700";case"testing":return"bg-primary-100 dark:bg-primary-500/30";case"success":return"bg-green-100 dark:bg-green-500/30";case"error":return"bg-red-100 dark:bg-red-500/30";default:return"bg-gray-200 dark:bg-gray-700"}}),I=j(()=>{switch(d.value){case"idle":return"fa-hourglass-start";case"testing":return"fa-spinner fa-spin";case"success":return"fa-check-circle";case"error":return"fa-exclamation-circle";default:return"fa-question-circle"}}),E=j(()=>{switch(d.value){case"idle":return"text-gray-500 dark:text-gray-400";case"testing":return"text-primary-500 dark:text-primary-400";case"success":return"text-green-500 dark:text-green-400";case"error":return"text-red-500 dark:text-red-400";default:return"text-gray-500 dark:text-gray-400"}}),Q=j(()=>{switch(d.value){case"idle":return"text-gray-700 dark:text-gray-300";case"testing":return"text-primary-700 dark:text-primary-300";case"success":return"text-green-700 dark:text-green-300";case"error":return"text-red-700 dark:text-red-300";default:return"text-gray-700 dark:text-gray-300"}});async function z(){if(!s.apiKeyValue)return;d.value="testing",g.value="",m.value="",x.value=0,h.value=Date.now(),L.value&&L.value.abort(),L.value=new AbortController;const q=`${St}/apiStats/api-key/test`;try{const $=await fetch(q,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:s.apiKeyValue,model:y.value}),signal:L.value.signal});if(!$.ok){const J=await $.json().catch(()=>({}));throw new Error(J.message||J.error||`HTTP ${$.status}`)}const U=$.body.getReader(),S=new TextDecoder;let X=!1;for(;!X;){const{done:J,value:Y}=await U.read();if(J){X=!0;continue}const o=S.decode(Y).split(`
`);for(const a of o)if(a.startsWith("data: "))try{const C=JSON.parse(a.substring(6));B(C)}catch{}}}catch($){if($.name==="AbortError")return;d.value="error",m.value=$.message||"连接失败",x.value=Date.now()-h.value}}function B(q){switch(q.type){case"test_start":break;case"content":g.value+=q.text;break;case"message_stop":break;case"test_complete":x.value=Date.now()-h.value,q.success?d.value="success":(d.value="error",m.value=q.error||"测试失败");break;case"error":d.value="error",m.value=q.error||"未知错误",x.value=Date.now()-h.value;break}}function V(){d.value!=="testing"&&(L.value&&(L.value.abort(),L.value=null),d.value="idle",g.value="",m.value="",x.value=0,f("close"))}return pt(()=>s.show,q=>{q&&(d.value="idle",g.value="",m.value="",x.value=0)}),vt(()=>{L.value&&L.value.abort()}),(q,$)=>(r(),nt(_t,{to:"body"},[R.show?(r(),n("div",Pr,[t("div",{class:"absolute inset-0",onClick:V}),t("div",Ir,[t("div",Mr,[t("div",Dr,[t("div",{class:M(["flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-xl text-white shadow-lg",d.value==="success"?"bg-gradient-to-br from-green-500 to-emerald-500":d.value==="error"?"bg-gradient-to-br from-red-500 to-pink-500":"bg-gradient-to-br from-primary-500 to-secondary-500"])},[t("i",{class:M(["fas",d.value==="idle"?"fa-vial":d.value==="testing"?"fa-spinner fa-spin":d.value==="success"?"fa-check":"fa-times"])},null,2)],2),t("div",null,[$[0]||($[0]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"}," API Key 端点测试 ",-1)),t("p",qr,i(K.value),1)])]),t("button",{class:"flex h-9 w-9 items-center justify-center rounded-full bg-gray-100 text-gray-500 transition hover:bg-gray-200 hover:text-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-200",disabled:d.value==="testing",onClick:V},$[1]||($[1]=[t("i",{class:"fas fa-times text-sm"},null,-1)]),8,jr)]),t("div",Ur,[t("div",Rr,[$[3]||($[3]=t("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," API Key ",-1)),t("div",Nr,[t("input",{class:"w-full rounded-lg border border-gray-200 bg-gray-50 px-3 py-2 pr-10 text-sm text-gray-700 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",readonly:"",type:"text",value:N.value},null,8,Or),$[2]||($[2]=t("div",{class:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400"},[t("i",{class:"fas fa-lock text-xs"})],-1))]),$[4]||($[4]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," 测试将使用此 API Key 调用当前服务的 /api 端点 ",-1))]),t("div",Er,[$[6]||($[6]=t("div",{class:"flex items-center justify-between text-sm"},[t("span",{class:"text-gray-500 dark:text-gray-400"},"测试端点"),t("span",{class:"inline-flex items-center gap-1.5 rounded-full bg-primary-100 px-2.5 py-0.5 text-xs font-medium text-primary-700 dark:bg-primary-500/20 dark:text-primary-300"},[t("i",{class:"fas fa-link"}),b(" /api/v1/messages ")])],-1)),t("div",Fr,[$[5]||($[5]=t("span",{class:"text-gray-500 dark:text-gray-400"},"测试模型",-1)),t("span",Wr,i(y.value),1)]),$[7]||($[7]=t("div",{class:"flex items-center justify-between text-sm"},[t("span",{class:"text-gray-500 dark:text-gray-400"},"模拟客户端"),t("span",{class:"font-medium text-gray-700 dark:text-gray-300"},"Claude Code")],-1))]),t("div",{class:M(["mb-4 rounded-xl border p-4 transition-all duration-300",c.value])},[t("div",Br,[t("div",{class:M(["flex h-8 w-8 items-center justify-center rounded-lg",l.value])},[t("i",{class:M(["fas text-sm",I.value,E.value])},null,2)],2),t("div",null,[t("p",{class:M(["font-medium",Q.value])},i(w.value),3),t("p",Vr,i(_.value),1)])])],2),d.value!=="idle"?(r(),n("div",zr,[t("div",Jr,[$[8]||($[8]=t("span",{class:"text-xs font-medium text-gray-600 dark:text-gray-400"},"AI 响应",-1)),g.value?(r(),n("span",Hr,i(g.value.length)+" 字符 ",1)):A("",!0)]),t("div",Yr,[g.value?(r(),n("p",Gr,[b(i(g.value)+" ",1),d.value==="testing"?(r(),n("span",Qr)):A("",!0)])):d.value==="testing"?(r(),n("p",Xr,$[9]||($[9]=[t("i",{class:"fas fa-circle-notch fa-spin"},null,-1),b(" 等待响应中... ",-1)]))):d.value==="error"&&m.value?(r(),n("p",Zr,i(m.value),1)):A("",!0)])])):A("",!0),x.value>0?(r(),n("div",ti,[$[10]||($[10]=t("i",{class:"fas fa-clock"},null,-1)),t("span",null,"耗时 "+i((x.value/1e3).toFixed(2))+" 秒",1)])):A("",!0)]),t("div",ei,[t("button",{class:"rounded-lg border border-gray-200 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm transition hover:bg-gray-50 hover:shadow dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700",disabled:d.value==="testing",onClick:V}," 关闭 ",8,si),t("button",{class:M(["flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium shadow-sm transition",d.value==="testing"||!R.apiKeyValue?"cursor-not-allowed bg-gray-200 text-gray-400 dark:bg-gray-700 dark:text-gray-500":"bg-gradient-to-r from-primary-500 to-secondary-500 text-white hover:from-primary-600 hover:to-secondary-600 hover:shadow-md"]),disabled:d.value==="testing"||!R.apiKeyValue,onClick:z},[t("i",{class:M(["fas",d.value==="testing"?"fa-spinner fa-spin":"fa-play"])},null,2),b(" "+i(d.value==="testing"?"测试中...":d.value==="idle"?"开始测试":"重新测试"),1)],10,ai)])])])):A("",!0)]))}},ii={class:"glass-strong mb-6 rounded-3xl p-4 shadow-xl md:mb-8 md:p-6"},li={class:"flex flex-col items-center justify-between gap-4 md:flex-row"},oi={class:"flex items-center gap-2 md:gap-4"},ni={class:"flex items-center"},di={key:0,class:"h-8 w-px bg-gradient-to-b from-transparent via-gray-300 to-transparent opacity-50 dark:via-gray-600"},ci={class:"mb-6 md:mb-8"},ui={class:"flex justify-center"},mi={class:"inline-flex w-full max-w-md rounded-full border border-white/20 bg-white/10 p-1 shadow-lg backdrop-blur-xl md:w-auto"},gi={key:0,class:"tab-content"},yi={key:0,class:"mb-6 md:mb-8"},xi={class:"rounded-xl border border-red-500/30 bg-red-500/20 p-3 text-sm text-red-800 backdrop-blur-sm dark:border-red-500/20 dark:bg-red-500/10 dark:text-red-200 md:p-4 md:text-base"},fi={key:1,class:"fade-in"},pi={class:"glass-strong rounded-3xl p-4 shadow-xl md:p-6"},vi={class:"mb-4 border-b border-gray-200 pb-4 dark:border-gray-700 md:mb-6 md:pb-6"},bi={class:"flex flex-col items-start justify-between gap-3 md:flex-row md:items-center md:gap-4"},ki={class:"flex w-full items-center gap-2 md:w-auto"},_i=["disabled"],hi=["disabled"],wi=["disabled"],$i={class:"mb-6 mt-6 grid grid-cols-1 gap-4 md:mb-8 md:mt-8 md:gap-6 xl:grid-cols-2 xl:items-stretch"},Si={key:1,class:"tab-content"},Ci={class:"glass-strong rounded-3xl shadow-xl"},Ti={__name:"ApiStatsView",setup(R){const p=wt(),s=rt(),f=Ct(),d=D("stats"),g=j(()=>f.isDarkMode),{apiKey:m,apiId:x,loading:h,modelStatsLoading:L,oemLoading:y,error:K,statsPeriod:N,statsData:w,oemSettings:_,multiKeyMode:c}=st(s),{queryStats:l,switchPeriod:I,loadStatsWithApiId:E,loadOemSettings:Q,reset:z}=s,B=D(!1),V=()=>{B.value=!0},q=()=>{B.value=!1},$=U=>{(U.ctrlKey||U.metaKey)&&U.key==="Enter"&&(!h.value&&m.value.trim()&&l(),U.preventDefault()),U.key==="Escape"&&z()};return ht(()=>{f.initTheme(),Q();const U=p.query.apiId,S=p.query.apiKey;U&&U.match(/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/i)?(x.value=U,E()):S&&S.length>10&&(m.value=S),document.addEventListener("keydown",$)}),vt(()=>{document.removeEventListener("keydown",$)}),pt(m,U=>{U||s.clearData()}),(U,S)=>{var J;const X=$t("router-link");return r(),n("div",{class:M(["min-h-screen p-4 md:p-6",g.value?"gradient-bg-dark":"gradient-bg"])},[t("div",ii,[t("div",li,[W(Tt,{loading:e(y),"logo-src":e(_).siteIconData||e(_).siteIcon,subtitle:d.value==="stats"?"API Key 使用统计":"使用教程",title:e(_).siteName},null,8,["loading","logo-src","subtitle","title"]),t("div",oi,[t("div",ni,[W(Kt,{mode:"dropdown"})]),e(_).ldapEnabled||e(_).showAdminButton!==!1?(r(),n("div",di)):A("",!0),e(_).ldapEnabled?(r(),nt(X,{key:1,class:"user-login-button flex items-center gap-2 rounded-2xl px-4 py-2 text-white transition-all duration-300 md:px-5 md:py-2.5",to:"/user-login"},{default:lt(()=>S[4]||(S[4]=[t("i",{class:"fas fa-user text-sm md:text-base"},null,-1),t("span",{class:"text-xs font-semibold tracking-wide md:text-sm"},"用户登录",-1)])),_:1,__:[4]})):A("",!0),e(_).showAdminButton!==!1?(r(),nt(X,{key:2,class:"admin-button-refined flex items-center gap-2 rounded-2xl px-4 py-2 transition-all duration-300 md:px-5 md:py-2.5",to:"/dashboard"},{default:lt(()=>S[5]||(S[5]=[t("i",{class:"fas fa-shield-alt text-sm md:text-base"},null,-1),t("span",{class:"text-xs font-semibold tracking-wide md:text-sm"},"管理后台",-1)])),_:1,__:[5]})):A("",!0)])])]),t("div",ci,[t("div",ui,[t("div",mi,[t("button",{class:M(["tab-pill-button",d.value==="stats"?"active":""]),onClick:S[0]||(S[0]=Y=>d.value="stats")},S[6]||(S[6]=[t("i",{class:"fas fa-chart-line mr-1 md:mr-2"},null,-1),t("span",{class:"text-sm md:text-base"},"统计查询",-1)]),2),t("button",{class:M(["tab-pill-button",d.value==="tutorial"?"active":""]),onClick:S[1]||(S[1]=Y=>d.value="tutorial")},S[7]||(S[7]=[t("i",{class:"fas fa-graduation-cap mr-1 md:mr-2"},null,-1),t("span",{class:"text-sm md:text-base"},"使用教程",-1)]),2)])])]),d.value==="stats"?(r(),n("div",gi,[W(te),e(K)?(r(),n("div",yi,[t("div",xi,[S[8]||(S[8]=t("i",{class:"fas fa-exclamation-triangle mr-2"},null,-1)),b(" "+i(e(K)),1)])])):A("",!0),e(w)?(r(),n("div",fi,[t("div",pi,[t("div",vi,[t("div",bi,[S[12]||(S[12]=t("div",{class:"flex items-center gap-2 md:gap-3"},[t("i",{class:"fas fa-clock text-base text-primary-500 md:text-lg"}),t("span",{class:"text-base font-medium text-gray-700 dark:text-gray-200 md:text-lg"},"统计时间范围")],-1)),t("div",ki,[t("button",{class:M(["flex flex-1 items-center justify-center gap-1 px-4 py-2 text-xs font-medium md:flex-none md:gap-2 md:px-6 md:text-sm",["period-btn",{active:e(N)==="daily"}]]),disabled:e(h)||e(L),onClick:S[2]||(S[2]=Y=>e(I)("daily"))},S[9]||(S[9]=[t("i",{class:"fas fa-calendar-day text-xs md:text-sm"},null,-1),b(" 今日 ",-1)]),10,_i),t("button",{class:M(["flex flex-1 items-center justify-center gap-1 px-4 py-2 text-xs font-medium md:flex-none md:gap-2 md:px-6 md:text-sm",["period-btn",{active:e(N)==="monthly"}]]),disabled:e(h)||e(L),onClick:S[3]||(S[3]=Y=>e(I)("monthly"))},S[10]||(S[10]=[t("i",{class:"fas fa-calendar-alt text-xs md:text-sm"},null,-1),b(" 本月 ",-1)]),10,hi),e(c)?A("",!0):(r(),n("button",{key:0,class:"test-btn flex items-center justify-center gap-1 px-4 py-2 text-xs font-medium md:gap-2 md:px-6 md:text-sm",disabled:e(h),onClick:V},S[11]||(S[11]=[t("i",{class:"fas fa-vial text-xs md:text-sm"},null,-1),b(" 测试 ",-1)]),8,wi))])])]),W(xs),t("div",$i,[W(Ms,{class:"h-full"}),e(c)?(r(),nt(ir,{key:0,class:"h-full"})):(r(),nt(Ba,{key:1,class:"h-full"}))]),W(Lr)])])):A("",!0)])):A("",!0),d.value==="tutorial"?(r(),n("div",Si,[t("div",Ci,[W(Mt)])])):A("",!0),W(ri,{"api-key-name":((J=e(w))==null?void 0:J.name)||"","api-key-value":e(m),show:B.value,onClose:q},null,8,["api-key-name","api-key-value","show"])],2)}}},Ri=at(Ti,[["__scopeId","data-v-96c5fb12"]]);export{Ri as default};
